<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Delivery App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'food-red': '#FF4444',
                        'food-orange': '#FF8A00',
                        'food-yellow': '#FFD700',
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }

        /* The main container to simulate the mobile screen dimensions */
        .mobile-frame {
            max-width: 420px;
            min-height: 100vh;
            margin: auto;
            background-color: white;
            position: relative;
            overflow-x: hidden;
            /* Prevent horizontal scrolling */
        }

        /* Custom gradient for the Driver Status bar */
        .driver-status-gradient {
            background: linear-gradient(90deg, #ffdd57, #ff9f43);
            /* Yellow to Orange/Peach gradient */
        }

        /* Custom shadow for cards */
        .card-shadow {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* Style for the tracking steps icons/indicators */
        .step-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #f1f1f1;
            /* Light gray background */
            color: #777;
            /* Gray icon color */
        }

        /* Placeholder for the current step (Driver Found/On The Way) */
        .step-icon.active {
            background-color: #ffdd57;
            color: #333;
            /* Darker text/icon color for active state */
        }

        /* Placeholder for the progress line between steps */
        .step-line {
            height: 2px;
            flex-grow: 1;
            background-color: #e0e0e0;
        }

        /* Custom style to prevent body scroll when modal is active */
        .modal-open {
            overflow: hidden;
        }

        /* --- CHAT STYLES --- */
        .driver-bubble {
            background-color: #f1f1f1;
            /* Light gray background for driver's message */
            color: #333;
            /* Dark text */
            border-radius: 1rem 1rem 1rem 0.2rem;
            max-width: 80%;
            padding: 0.6rem 1rem;
            /* Padding for inside the bubble */
            margin-bottom: 0.5rem;
            line-height: 1.4;
            /* For readability */
            align-self: flex-start;
        }

        .user-bubble {
            background-color: #ff5555;
            /* Red background for user's message */
            color: white;
            /* White text */
            border-radius: 1rem 1rem 0.2rem 1rem;
            max-width: 80%;
            padding: 0.6rem 1rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
            align-self: flex-end;
        }

        .chat-time {
            font-size: 0.65rem;
            color: #999;
            align-self: flex-end;
            margin-top: 0.25rem;
        }

        .user-chat-time {
            color: #f8e1e1;
            /* Lighter color for red background */
        }

        /* --- ATTACHMENT MODAL --- */
        #attachmentMenu {
            /* Initial state: hidden off-screen */
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-width: 420px;
            margin: auto;
            border-radius: 1rem 1rem 0 0;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
            z-index: 50;
            /* Ensure it is on top of the input field (z-40) */
        }

        #attachmentMenu.active {
            /* Active state: slide in */
            transform: translateY(0);
        }

        .attachment-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 0;
            border-radius: 0.5rem;
            transition: background-color 0.15s;
            cursor: pointer;
        }

        .attachment-icon-bg {
            /* Orange gradient background for icons */
            background: linear-gradient(135deg, #ffdd57, #ff9f43);
            width: 4.5rem;
            height: 4.5rem;
            border-radius: 50%;
            margin-bottom: 0.5rem;
            box-shadow: 0 4px 10px rgba(255, 159, 67, 0.3);
        }

        /* Slide Up/Down Full Screen Modal Base (for Cancel Order Modal) */
        .modal-slide {
            transform: translateY(100%);
            transition-property: transform;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            /* ease-in-out */
            transition-duration: 300ms;
        }

        .modal-slide.active {
            transform: translateY(0);
        }

        /* Custom styles for the hearts in the success modal */
        .heart-icon {
            filter: drop-shadow(0 4px 10px rgba(255, 69, 58, 0.4));
        }
    </style>
</head>

<body class="bg-white min-h-screen">
    <!-- Header Section -->
    <div class="px-4 py-3 bg-white">
        <div class="flex justify-between items-center">
            <button id="openLocationBtn" class="text-left">
                <p class="text-gray-500 text-sm">Deliver to</p>
                <div class="flex items-center">
                    <p class="text-gray-700 text-sm">Select Your Location</p>
                    <i class="fas fa-chevron-down text-red-500 text-xs ml-1"></i>
                </div>
            </button>
            <div class="flex space-x-3">
                <button id="openCartBtn" class="text-gray-600 text-lg">
                    <i class="fas fa-shopping-bag"></i>
                </button>
                <button id="openSearchBtn" class="text-gray-600 text-lg">
                    <i class="fas fa-search"></i>
                </button>
                <button id="openSheetBtn" class="text-gray-600 text-lg">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 1. Header -->
    <header class="p-4 flex items-center justify-between shadow-sm border-b border-gray-100 flex-shrink-0">
        <button class="text-gray-600">
            <!-- Back Arrow Icon (Heroicons outline: arrow-left) -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
        </button>
        <h1 class="text-xl font-semibold text-gray-800">Order Tracking</h1>
        <div class="w-6"></div> <!-- Spacer to center the title -->
    </header>

    <!-- 2. Map Placeholder - Now with a visual map iframe -->
    <div class="w-full relative overflow-hidden flex-shrink-0" style="height: 350px;">
        <!-- Google Maps Iframe Embed -->
        <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3305.698379162973!2d151.20914619999998!3d-33.86881977799279!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6b12a2e4c4e4f71f%3A0xf5b5c7e1d5a7d7f7!2sSydney%20Opera%20House!5e0!3m2!1sen!2sau!4v1620242424242!5m2!1sen!2sau"
            width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>

        <!-- Current Location Marker (Top right control overlay) -->
        <div class="absolute" style="top: 15px; right: 15px;">
            <button
                class="w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center border border-gray-200">
                <!-- Target Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-700" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                        clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </div>


    <!-- Main content area below the map -->
    <div class="p-4 flex-grow">

        <!-- 3. Driver Information Card -->
        <!-- Made the entire card clickable to open the Driver Info Modal -->
        <div onclick="showDriverInfoModal()"
            class="driver-status-gradient rounded-full p-3 mb-6 card-shadow flex items-center justify-between cursor-pointer active:scale-[0.99] transition transform duration-100">

            <!-- Left Section: Avatar and Info -->
            <div class="flex items-center space-x-3">
                <!-- Driver Avatar Placeholder (Using a generic image) -->
                <img src="https://images.unsplash.com/photo-1627083204904-58a43615177a?q=80&w=1780&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                    alt="David Wayne Avatar" class="w-12 h-12 rounded-full object-cover border-2 border-white/50"
                    onerror="this.onerror=null;this.src='https://placehold.co/48x48/ff9f43/ffffff?text=DW';">

                <div>
                    <p class="text-base font-bold text-gray-900 leading-tight">David Wayne</p>
                    <div class="flex items-center space-x-1 text-sm text-gray-700 mt-0.5">
                        <!-- Star Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 fill-current"
                            viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <span class="font-semibold text-xs text-gray-800">4.9</span>
                        <span class="text-gray-500 text-xs">|</span>
                        <span class="text-xs text-gray-600">ID DW2125</span>
                    </div>
                </div>
            </div>

            <!-- Right Section: Action Buttons -->
            <div class="flex items-center space-x-3 pr-2">
                <!-- Message Button - NOW CALLS CHAT MODAL -->
                <button onclick="event.stopPropagation(); showChatModal();"
                    class="w-10 h-10 bg-white/70 rounded-full flex items-center justify-center shadow hover:bg-white transition duration-150">
                    <!-- Chat Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 4v-4z" />
                    </svg>
                </button>
                <!-- Call Button -->
                <a href="tel:+442012345689"
                    class="w-10 h-10 bg-white/70 rounded-full flex items-center justify-center shadow hover:bg-white transition duration-150">
                    <i class="fas fa-phone"></i>
                </a>
            </div>
        </div>

        <!-- 4. Tracking Steps -->
        <div class="flex items-center justify-between mb-8 px-4">
            <!-- Step 1: Order Placed (Active/Current step visually) -->
            <div class="step-icon active">
                <!-- Home Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                </svg>
            </div>
            <div class="step-line bg-yellow-200"></div>

            <!-- Step 2: Food Prepared -->
            <div class="step-icon">
                <!-- Package/Box Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7z" />
                    <path fill-rule="evenodd"
                        d="M15.414 7l-3.707-3.707a1 1 0 00-.707-.293H7a3 3 0 00-3 3v10a3 3 0 003 3h6a3 3 0 003-3V7.414a1 1 0 00-.293-.707zM10 13a3 3 0 100-6 3 3 0 000 6z"
                        clip-rule="evenodd" />
                </svg>
            </div>
            <div class="step-line"></div>

            <!-- Step 3: Driver On The Way -->
            <div class="step-icon">
                <!-- Motorcycle/Delivery Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M5 4a1 1 0 00-1 1v1h12V5a1 1 0 00-1-1H5zM4 9h12v4a2 2 0 01-2 2H6a2 2 0 01-2-2V9zm-1 7a1 1 0 102 0 1 1 0 00-2 0zm10 0a1 1 0 102 0 1 1 0 00-2 0z" />
                </svg>
            </div>
            <div class="step-line"></div>

            <!-- Step 4: Delivered -->
            <div class="step-icon">
                <!-- Checkmark Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        clip-rule="evenodd" />
                </svg>
            </div>
        </div>

        <!-- 5. Order Details -->
        <div class="space-y-4 mb-8">
            <div class="flex justify-between items-center text-gray-800">
                <span class="text-base font-medium">Estimated Delivery Time</span>
                <span class="text-xl font-bold text-gray-900">10:25</span>
            </div>

            <div class="flex justify-between items-center py-2">
                <span class="text-base font-medium text-gray-800">My Order</span>
                <!-- Updated button to call the new modal function -->
                <button id="seeDetailsButton" onclick="showDetailsModal()"
                    class="text-red-500 border border-red-200 bg-red-50 px-4 py-1 rounded-full text-sm font-medium">
                    Details
                </button>
            </div>

            <div class="flex justify-between items-center py-2">
                <span class="text-base font-medium text-gray-800">Order Verify Code</span>
                <!-- Added ID and onclick for JavaScript functionality -->
                <button id="seeCodeButton" onclick="showCodeModal()"
                    class="text-red-500 border border-red-200 bg-red-50 px-4 py-1 rounded-full text-sm font-medium">
                    See Code
                </button>
            </div>
        </div>

        <!-- 6. Cancel Button (Wrapper for padding) -->
        <div class="w-full pt-4">
            <button onclick="showCancelModal()"
                class="w-full py-3 text-lg font-semibold text-red-500 rounded-lg border-2 border-red-100 transition duration-150 ease-in-out hover:bg-red-50 active:scale-[0.99]">
                Cancel Order
            </button>
        </div>

    </div>


    <!-- Bottom Navigation -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200">
        <div class="flex justify-around items-center py-2">
            <div class="flex flex-col items-center">
                <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center mb-1">
                    <i class="fas fa-home text-white text-sm"></i>
                </div>
                <span class="text-red-500 text-xs font-medium">Food</span>
            </div>
            <div class="flex flex-col items-center">
                <i class="fas fa-list text-gray-400 text-lg mb-1"></i>
            </div>
            <div class="flex flex-col items-center">
                <i class="fas fa-heart text-gray-400 text-lg mb-1"></i>
            </div>
            <div class="flex flex-col items-center">
                <i class="fas fa-bell text-gray-400 text-lg mb-1"></i>
            </div>
            <div class="flex flex-col items-center">
                <i class="fas fa-user text-gray-400 text-lg mb-1"></i>
            </div>
        </div>
    </div>

    <!-- Add bottom padding to prevent content from being hidden behind navigation -->
    <div class="h-16"></div>

    <!-- Bottom Sheet Modal -->
    <div id="moduleSheet" class="fixed inset-0 z-40 hidden">
        <!-- Backdrop -->
        <div id="sheetBackdrop" class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-300"></div>
        <!-- Sheet -->
        <div id="sheetPanel"
            class="absolute left-1/2 bottom-0 -translate-x-1/2 translate-y-full w-[92%] max-w-md bg-white rounded-t-2xl shadow-xl transition-transform duration-400">
            <div class="pt-3 pb-1 flex justify-center">
                <div class="w-16 h-1.5 bg-gray-300 rounded-full"></div>
            </div>
            <div class="px-5 pb-5">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Select a type of module for your orders</h3>
                <!-- Grid options -->
                <div class="grid grid-cols-3 gap-4">
                    <!-- Item template repeated -->
                    <button
                        class="group rounded-xl p-4 bg-white shadow-sm ring-1 ring-gray-100 hover:shadow-md transition">
                        <div class="w-12 h-12 rounded-lg bg-green-100 mx-auto mb-2 flex items-center justify-center">
                            <span class="text-green-500 font-semibold">?</span>
                        </div>
                        <div class="text-center text-sm text-gray-700">Grocery</div>
                    </button>
                    <button
                        class="group rounded-xl p-4 bg-white shadow-sm ring-1 ring-gray-100 hover:shadow-md transition">
                        <div class="w-12 h-12 rounded-lg bg-blue-100 mx-auto mb-2 flex items-center justify-center">
                            <span class="text-blue-500 font-semibold">?</span>
                        </div>
                        <div class="text-center text-sm text-gray-700">Pharmacy</div>
                    </button>
                    <button
                        class="group rounded-xl p-4 bg-white shadow-sm ring-1 ring-gray-100 hover:shadow-md transition">
                        <div class="w-12 h-12 rounded-lg bg-pink-100 mx-auto mb-2 flex items-center justify-center">
                            <span class="text-pink-500 font-semibold">??</span>
                        </div>
                        <div class="text-center text-sm text-gray-700">Shop</div>
                    </button>
                    <button class="group rounded-xl p-4 bg-white shadow-[0_0_0_2px_#fecaca] ring-1 ring-red-300">
                        <div class="w-12 h-12 rounded-lg bg-amber-100 mx-auto mb-2 flex items-center justify-center">
                            <span class="text-amber-500 font-semibold">?</span>
                        </div>
                        <div class="text-center text-sm text-red-500 font-semibold">Food</div>
                    </button>
                    <button
                        class="group rounded-xl p-4 bg-white shadow-sm ring-1 ring-gray-100 hover:shadow-md transition">
                        <div class="w-12 h-12 rounded-lg bg-indigo-100 mx-auto mb-2 flex items-center justify-center">
                            <span class="text-indigo-500 font-semibold">?</span>
                        </div>
                        <div class="text-center text-sm text-gray-700">Parcel</div>
                    </button>
                    <button
                        class="group rounded-xl p-4 bg-white shadow-sm ring-1 ring-gray-100 hover:shadow-md transition">
                        <div class="w-12 h-12 rounded-lg bg-rose-100 mx-auto mb-2 flex items-center justify-center">
                            <span class="text-rose-500 font-semibold">?</span>
                        </div>
                        <div class="text-center text-sm text-gray-700">Rental</div>
                    </button>
                </div>
                <div class="mt-5">
                    <div class="flex items-center gap-2 text-xs text-slate-600 bg-slate-100 rounded-xl px-3 py-3">
                        <i class="fas fa-info-circle text-blue-500"></i>
                        <span>A module must be selected to continue.</span>
                    </div>
                </div>
                <div class="mt-4 flex justify-end">
                    <button id="closeSheetBtn" class="px-4 py-2 text-sm text-gray-600">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal Page -->
    <div id="searchModal" class="fixed inset-0 z-50 hidden">
        <!-- Backdrop -->
        <div id="searchBackdrop" class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-300"></div>
        <!-- Card Panel -->
        <div id="searchPanel"
            class="fixed inset-0 translate-y-full w-full h-full bg-white rounded-none shadow-none overflow-hidden transition-transform duration-400 flex flex-col">
            <!-- Header -->
            <div class="flex items-center px-4 py-3 border-b border-gray-100 sticky top-0 bg-white z-10">
                <button id="closeSearchBtn" class="text-gray-600 mr-2">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h3 class="flex-1 text-center font-semibold">Search</h3>
                <div class="w-6"></div>
            </div>
            <!-- Content -->
            <div class="p-4 overflow-y-auto flex-1">
                <!-- Promo input -->
                <div class="flex items-center bg-gray-100 rounded-lg px-3 py-2 mb-4">
                    <input type="text" placeholder="Promo Code"
                        class="flex-1 bg-transparent text-sm text-gray-600 placeholder-gray-400 focus:outline-none">
                    <button class="text-sm text-red-500 font-semibold">Apply</button>
                </div>

                <div class="text-xs text-gray-500 mb-2">Shipping Offers</div>
                <div class="space-y-3 mb-4">
                    <label
                        class="flex items-center justify-between bg-white rounded-xl shadow-sm ring-1 ring-gray-100 px-3 py-3">
                        <div class="flex items-center gap-3">
                            <span
                                class="w-6 h-6 rounded bg-amber-100 text-amber-500 flex items-center justify-center text-xs">%</span>
                            <span class="text-sm font-semibold text-gray-800">FREE SHIPPING</span>
                            <i class="fas fa-info-circle text-gray-300 text-xs"></i>
                        </div>
                        <input type="checkbox" class="w-5 h-5 rounded border-gray-300">
                    </label>
                    <label
                        class="flex items-center justify-between bg-white rounded-xl shadow-sm ring-1 ring-gray-100 px-3 py-3">
                        <div class="flex items-center gap-3">
                            <span
                                class="w-6 h-6 rounded bg-amber-100 text-amber-500 flex items-center justify-center text-xs">%</span>
                            <span class="text-sm font-semibold text-gray-800">20% OFF</span>
                            <i class="fas fa-info-circle text-gray-300 text-xs"></i>
                        </div>
                        <input type="checkbox" class="w-5 h-5 rounded border-gray-300">
                    </label>
                </div>

                <div class="text-xs text-gray-500 mb-2">Order Offers</div>
                <div class="space-y-3 mb-4">
                    <label
                        class="flex items-center justify-between bg-white rounded-xl shadow-sm ring-1 ring-gray-100 px-3 py-3">
                        <div class="flex items-center gap-3">
                            <span
                                class="w-6 h-6 rounded bg-amber-100 text-amber-500 flex items-center justify-center text-xs">%</span>
                            <span class="text-sm font-semibold text-gray-800">20% OFF</span>
                        </div>
                        <input type="checkbox" class="w-5 h-5 rounded border-gray-300">
                    </label>
                    <label
                        class="flex items-center justify-between bg-white rounded-xl shadow-sm ring-1 ring-gray-100 px-3 py-3">
                        <div class="flex items-center gap-3">
                            <span
                                class="w-6 h-6 rounded bg-amber-100 text-amber-500 flex items-center justify-center text-xs">%</span>
                            <span class="text-sm font-semibold text-gray-800">10% OFF</span>
                        </div>
                        <input type="checkbox" class="w-5 h-5 rounded border-gray-300">
                    </label>
                </div>

                <button
                    class="w-full flex items-center justify-between bg-rose-50 text-rose-500 rounded-xl px-3 py-3 mb-5">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span class="text-sm font-semibold">Get More Promotions</span>
                    </div>
                </button>

                <button
                    class="w-full bg-gradient-to-r from-red-500 to-orange-400 text-white rounded-full py-3 font-semibold shadow">
                    Apply
                </button>
            </div>
        </div>
    </div>

    <!-- Locations Modal Page -->
    <div id="locationModal" class="fixed inset-0 z-50 hidden">
        <div id="locationBackdrop" class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-300"></div>
        <div id="locationPanel"
            class="fixed inset-0 translate-y-full w-full h-full bg-white rounded-none overflow-hidden transition-transform duration-400 flex flex-col">
            <!-- Header -->
            <div class="flex items-center px-4 py-3 border-b border-gray-100 sticky top-0 bg-white z-10">
                <button id="closeLocationBtn" class="text-gray-600 mr-2">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h3 class="flex-1 text-center font-semibold">My Locations</h3>
                <div class="w-6"></div>
            </div>
            <!-- Body -->
            <div class="p-4 overflow-y-auto flex-1">
                <!-- Location card -->
                <label class="block bg-white rounded-xl shadow-sm ring-1 ring-gray-100 px-3 py-3 mb-3">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="text-sm font-semibold text-gray-900">Home</div>
                            <div class="text-xs text-gray-500">221B Baker Street, London, United Kingdom</div>
                        </div>
                        <input type="radio" name="locationRadio" value="Home" class="mt-1 w-5 h-5">
                    </div>
                </label>
                <label class="block bg-white rounded-xl shadow-sm ring-1 ring-gray-100 px-3 py-3 mb-3">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="text-sm font-semibold text-gray-900">Company</div>
                            <div class="text-xs text-gray-500">1A Baker Street, London, United Kingdom</div>
                        </div>
                        <input type="radio" name="locationRadio" value="Company" class="mt-1 w-5 h-5">
                    </div>
                </label>

                <button id="goAddLocationBtn"
                    class="w-full flex items-center justify-between bg-rose-50 text-rose-500 rounded-xl px-3 py-3">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span class="text-sm font-semibold">Add New Location</span>
                    </div>
                </button>
            </div>
            <!-- Footer -->
            <div class="p-4 border-t border-gray-100">
                <button id="applyLocationBtn"
                    class="w-full rounded-full py-3 font-semibold text-white bg-rose-300 cursor-not-allowed" disabled>
                    Apply
                </button>
            </div>
        </div>
    </div>

    <!-- DRIVER INFORMATION MODAL (Full screen slide transition) -->
    <div id="driverInfoModal"
        class="fixed inset-0 bg-white hidden flex flex-col z-50 transform translate-x-full transition-transform duration-300 ease-out mobile-frame">
        <div class="p-4 flex items-center justify-start border-b border-gray-100 shadow-sm flex-shrink-0">
            <button onclick="hideDriverInfoModal()" class="text-gray-600">
                <!-- Back Arrow Icon (Heroicons outline: arrow-left) -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </button>
            <h1 class="text-xl font-semibold text-gray-800 ml-4">Driver Information</h1>
        </div>

        <div class="flex-grow p-6 flex flex-col items-center overflow-y-auto">
            <!-- Driver Image -->
            <img src="https://images.unsplash.com/photo-1627083204904-58a43615177a?q=80&w=1780&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                alt="David Wayne Avatar"
                class="w-32 h-32 rounded-full object-cover border-4 border-yellow-300 shadow-lg mb-6"
                onerror="this.onerror=null;this.src='https://placehold.co/128x128/ff9f43/ffffff?text=DW';">

            <!-- Driver Name and Details -->
            <p class="text-xl font-bold text-gray-900 mb-1">David Wayne</p>
            <div class="flex items-center space-x-2 text-base text-gray-700 mb-12">
                <!-- Star Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 fill-current" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                <span class="font-semibold text-lg text-gray-800">4.9</span>
                <span class="text-gray-400">|</span>
                <span class="text-base text-gray-600" id="driverId">DW2125</span>
                <!-- Copy Icon -->
                <button onclick="copyDriverId('DW2125')"
                    class="text-gray-400 hover:text-gray-700 transition duration-150 p-1 rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M12 4a2 2 0 012-2h4a2 2 0 012 2v6a2 2 0 01-2 2h-4a2 2 0 01-2-2V4z" />
                    </svg>
                </button>
            </div>

            <!-- Action Buttons - Larger version -->
            <div class="flex items-center space-x-12 mb-10">
                <!-- Message Button - NOW CALLS CHAT MODAL -->
                <div class="flex flex-col items-center">
                    <button onclick="showChatModal()"
                        class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center shadow-md hover:bg-gray-200 transition duration-150">
                        <!-- Chat Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-700" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 4v-4z" />
                        </svg>
                    </button>
                    <span class="text-sm text-gray-600 mt-2">Message</span>
                </div>

                <!-- Call Button -->
                <div class="flex flex-col items-center">
                    <button
                        class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center shadow-md hover:bg-green-600 transition duration-150">
                        <!-- Phone Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M3 5a2 2 0 012-2h3.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a1 1 0 001 1h3a1 1 0 001-1v-1.586a1 1 0 01.293-.707l4.414-4.414A1 1 0 0121 7.414V17a4 4 0 01-4 4H7a4 4 0 01-4-4V7a2 2 0 012-2z" />
                        </svg>
                    </button>
                    <span class="text-sm text-gray-600 mt-2">Call</span>
                </div>
            </div>

            <!-- Driver Phone Number - Simulated Link -->
            <a href="tel:+442012345689"
                class="text-lg text-gray-700 font-medium flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-50">
                <span class="text-gray-400">(+44)</span>
                <span class="text-gray-800">20 1234 5689</span>
                <!-- Phone Icon (smaller) -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3 5a2 2 0 012-2h3.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a1 1 0 001 1h3a1 1 0 001-1v-1.586a1 1 0 01.293-.707l4.414-4.414A1 1 0 0121 7.414V17a4 4 0 01-4 4H7a4 4 0 01-4-4V7a2 2 0 012-2z" />
                </svg>
            </a>

        </div>
    </div>

    <!-- CHAT MODAL (Full screen slide transition) -->
    <div id="chatModal"
        class="fixed inset-0 bg-white hidden flex flex-col z-50 transform translate-x-full transition-transform duration-300 ease-out mobile-frame">

        <!-- Chat Header -->
        <div class="p-4 flex items-center justify-between border-b border-gray-100 shadow-sm flex-shrink-0">
            <div class="flex items-center">
                <!-- Back Button -->
                <button onclick="hideChatModal()" class="text-gray-600 mr-4">
                    <!-- Back Arrow Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <h1 class="text-xl font-semibold text-gray-800">Message</h1>
            </div>

            <!-- Video and Call Icons -->
            <div class="flex items-center space-x-4">
                <button class="text-gray-600 hover:text-gray-800 transition duration-150">
                    <!-- Video Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 012 2z" />
                    </svg>
                </button>
                <button class="text-green-600 hover:text-green-700 transition duration-150">
                    <!-- Call Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 5a2 2 0 012-2h3.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a1 1 0 001 1h3a1 1 0 001-1v-1.586a1 1 0 01.293-.707l4.414-4.414A1 1 0 0121 7.414V17a4 4 0 01-4 4H7a4 4 0 01-4-4V7a2 2 0 012-2z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Driver Info Bar -->
        <div class="flex items-center p-4 border-b border-gray-100 flex-shrink-0">
            <img src="https://images.unsplash.com/photo-1627083204904-58a43615177a?q=80&w=1780&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                alt="David Wayne Avatar" class="w-10 h-10 rounded-full object-cover mr-3"
                onerror="this.onerror=null;this.src='https://placehold.co/40x40/ff9f43/ffffff?text=DW';">
            <div>
                <p class="font-bold text-gray-800 leading-none">David Wayne</p>
                <p class="text-sm text-gray-500 leading-none">Driver</p>
            </div>
        </div>

        <!-- Chat Conversation Area -->
        <div class="flex-grow p-4 space-y-3 overflow-y-auto bg-white" id="chatWindow">

            <!-- Driver's Initial Message -->
            <div class="flex flex-col items-start">
                <div class="driver-bubble shadow-sm">
                    This is your delivery driver! I'm just around the corner from your place. 😀
                </div>
                <span class="chat-time">10:10</span>
            </div>

            <!-- User Message 1 -->
            <div class="flex flex-col items-end">
                <div class="user-bubble shadow-sm">
                    Hi!
                </div>
                <span class="chat-time user-chat-time">10:10</span>
            </div>

            <!-- User Message 2 -->
            <div class="flex flex-col items-end">
                <div class="user-bubble shadow-sm">
                    Awesome, thanks for letting me know! Can't wait for my delivery. 🍕
                </div>
                <span class="chat-time user-chat-time">10:11</span>
            </div>

            <!-- Driver's Second Message -->
            <div class="flex flex-col items-start">
                <div class="driver-bubble shadow-sm">
                    No problem at all! I'll be there in about 15 minutes.
                </div>
                <span class="chat-time">10:11</span>
            </div>

            <!-- Driver's Third Message -->
            <div class="flex flex-col items-start">
                <div class="driver-bubble shadow-sm">
                    I'll text you when I arrive.
                </div>
                <span class="chat-time">10:11</span>
            </div>

            <!-- User Message 3 (with Emoji as per image) -->
            <div class="flex flex-col items-end">
                <div class="user-bubble shadow-sm">
                    Great! 😃
                </div>
                <span class="chat-time user-chat-time">10:12</span>
            </div>

        </div>

        <!-- Chat Input Area -->
        <div class="p-3 border-t border-gray-100 flex items-center bg-white flex-shrink-0 relative z-40">
            <!-- Plus Icon for Attachments - Added onClick handler -->
            <button onclick="toggleAttachmentMenu()"
                class="text-red-500 p-2 hover:bg-gray-100 rounded-full transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                </svg>
            </button>
            <!-- Text Input -->
            <input type="text" placeholder="Type a message ..."
                class="flex-grow mx-3 p-3 bg-gray-100 rounded-full focus:outline-none focus:ring-2 focus:ring-red-300 text-gray-700"
                id="chatInput">
            <!-- Send Button -->
            <button
                class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center text-white shadow-md hover:bg-red-600 transition duration-150">
                <!-- Send Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 -rotate-45 ml-0.5" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
            </button>
        </div>
    </div>

    <!-- ATTACHMENT MENU MODAL (Slides up from bottom) -->
    <!-- The outer div acts as a translucent overlay/backdrop for the menu -->
    <div id="attachmentBackdrop" onclick="hideAttachmentMenu()"
        class="fixed inset-0 bg-black/30 hidden flex items-end z-40">
        <div id="attachmentMenu" class="w-full bg-white p-6 grid grid-cols-4 gap-4 flex-shrink-0">

            <!-- Camera Item -->
            <div class="attachment-item" onclick="showToast('Camera opened!'); hideAttachmentMenu();">
                <div class="attachment-icon-bg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.218A2 2 0 0110.404 4h3.192a2 2 0 011.664.89l.812 1.218A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </div>
                <span class="text-sm font-medium text-gray-700">Camera</span>
            </div>

            <!-- My Location Item -->
            <div class="attachment-item" onclick="showToast('Location shared!'); hideAttachmentMenu();">
                <div class="attachment-icon-bg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M17.657 16.727A8 8 0 016.343 5.273L17.657 16.727zm0 0A8 8 0 0118 10a8 8 0 01-8 8.003L17.657 16.727zM6.343 5.273L6 5.003V4.96A8.003 8.003 0 0010 2a8.003 8.003 0 004.974 1.63L6.343 5.273z" />
                    </svg>
                </div>
                <span class="text-sm font-medium text-gray-700">My Location</span>
            </div>

            <!-- Record Item -->
            <div class="attachment-item" onclick="showToast('Recording started...'); hideAttachmentMenu();">
                <div class="attachment-icon-bg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19 11a7 7 0 01-7 7v0m-7-7a7 7 0 017-7v0m-7 7h14m-7 7V5m0 0V3" />
                    </svg>
                </div>
                <span class="text-sm font-medium text-gray-700">Record</span>
            </div>

            <!-- Gallery Item -->
            <div class="attachment-item" onclick="showToast('Gallery opened!'); hideAttachmentMenu();">
                <div class="attachment-icon-bg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L15 14l5-5V20H4v-4z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14 8a2 2 0 10-4 0 2 2 0 004 0z" />
                    </svg>
                </div>
                <span class="text-sm font-medium text-gray-700">Gallery</span>
            </div>

        </div>
    </div>


    <!-- Verify Code Modal - Hidden by default -->
    <div id="verifyCodeModal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 shadow-2xl w-full max-w-sm transform transition-all duration-300 ease-in-out scale-95 opacity-0"
            id="verifyModalContent">
            <div class="flex justify-end">
                <button onclick="hideCodeModal()" class="text-gray-400 hover:text-gray-600">
                    <!-- Close Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <h2 class="text-xl font-bold text-center mb-2 text-gray-800">Order Verification Code</h2>
            <p class="text-center text-sm text-gray-500 mb-6">Show this code to your driver upon delivery.</p>

            <!-- Code Boxes -->
            <div id="codeDisplay" class="flex justify-center space-x-4 mb-8">
                <!-- These spans will be populated by JavaScript -->
                <span id="code-1"
                    class="w-12 h-16 text-3xl font-extrabold flex items-center justify-center border-2 border-red-400 rounded-lg text-red-500 bg-red-50"></span>
                <span id="code-2"
                    class="w-12 h-16 text-3xl font-extrabold flex items-center justify-center border-2 border-red-400 rounded-lg text-red-500 bg-red-50"></span>
                <span id="code-3"
                    class="w-12 h-16 text-3xl font-extrabold flex items-center justify-center border-2 border-red-400 rounded-lg text-red-500 bg-red-50"></span>
                <span id="code-4"
                    class="w-12 h-16 text-3xl font-extrabold flex items-center justify-center border-2 border-red-400 rounded-lg text-red-500 bg-red-50"></span>
            </div>

            <button onclick="hideCodeModal()"
                class="w-full bg-red-500 text-white py-3 rounded-lg font-semibold hover:bg-red-600 transition">
                Got It
            </button>
        </div>
    </div>

    <!-- Order Details Modal - NEW CONTENT -->
    <div id="orderDetailsModal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 shadow-2xl w-full max-w-sm transform transition-all duration-300 ease-in-out scale-95 opacity-0"
            id="detailsModalContent">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Order Summary</h2>
                <button onclick="hideDetailsModal()" class="text-gray-400 hover:text-gray-600">
                    <!-- Close Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="max-h-60 overflow-y-auto pr-2">
                <!-- Order Items List populated by JS -->
                <ul id="orderItemsList" class="space-y-3 mb-4">
                    <!-- Items will be injected here -->
                </ul>
            </div>

            <!-- Separator -->
            <hr class="my-4 border-gray-100">

            <!-- Totals Section populated by JS -->
            <div id="orderTotals" class="space-y-2">
                <div class="flex justify-between text-gray-600 text-sm">
                    <span>Subtotal:</span>
                    <span id="subtotal"></span>
                </div>
                <div class="flex justify-between text-gray-600 text-sm">
                    <span>Delivery Fee:</span>
                    <span id="deliveryFee"></span>
                </div>
                <div class="flex justify-between text-lg font-bold text-gray-900 pt-1">
                    <span>Total:</span>
                    <span id="total"></span>
                </div>
            </div>

            <button onclick="hideDetailsModal()"
                class="w-full mt-6 bg-red-500 text-white py-3 rounded-lg font-semibold hover:bg-red-600 transition">
                Close
            </button>
        </div>
    </div>

    <!-- CANCEL ORDER CONFIRMATION MODAL (Full screen slide up) -->
    <div id="cancelOrderModal"
        class="fixed inset-0 bg-white hidden flex flex-col justify-between z-[60] modal-slide mobile-frame">

        <!-- Header (Simulated Cancel Order screen before the final popup) -->
        <div class="p-4 flex items-center justify-start border-b border-gray-100 shadow-sm flex-shrink-0">
            <button onclick="hideCancelModal()" class="text-gray-600">
                <!-- Back Arrow Icon (Heroicons outline: arrow-left) -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </button>
            <h1 class="text-xl font-semibold text-gray-800 ml-4">Cancel Order</h1>
        </div>

        <!-- Mock Reason Selection UI -->
        <div class="flex-grow p-6 flex flex-col overflow-y-auto">
            <div class="space-y-4">
                <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                    <input type="radio" id="reason1" name="cancellationReason" class="text-red-500 focus:ring-red-500"
                        checked>
                    <label for="reason1" class="ml-3 text-gray-800 font-medium">Change of mind</label>
                </div>
                <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                    <input type="radio" id="reason2" name="cancellationReason" class="text-red-500 focus:ring-red-500">
                    <label for="reason2" class="ml-3 text-gray-800 font-medium">Driver taking too long</label>
                </div>
                <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                    <input type="radio" id="reason3" name="cancellationReason" class="text-red-500 focus:ring-red-500">
                    <label for="reason3" class="ml-3 text-gray-800 font-medium">Ordered by mistake</label>
                </div>

                <div class="pt-4">
                    <label for="otherReason" class="text-sm font-medium text-gray-600 mb-2 block">Other
                        reason...</label>
                    <textarea id="otherReason" rows="3"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500"></textarea>
                </div>
            </div>
        </div>

        <!-- Action Button (now calls the success modal) -->
        <div class="p-6 pt-0 flex-shrink-0">
            <button onclick="handleFinalCancellation()"
                class="w-full py-3 text-lg font-semibold text-white bg-red-500 rounded-lg shadow-lg hover:bg-red-600 transition active:scale-[0.99]">
                Submit
            </button>

            <!-- Secondary Action (To keep the order) - Added a simple back button at the bottom for better UX -->
            <button onclick="hideCancelModal()"
                class="w-full py-2 mt-3 text-sm font-medium text-gray-500 hover:text-gray-700 transition">
                Go back to tracking
            </button>
        </div>
    </div>

    <!-- *** NEW: CANCELLATION SUCCESS MODAL (Center Pop Up) *** -->
    <div id="orderCanceledSuccessModal"
        class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-[70] p-4">
        <div class="bg-white rounded-xl p-6 shadow-2xl w-full max-w-xs transform transition-all duration-300 ease-in-out scale-95 opacity-0"
            id="successModalContent">

            <div class="flex justify-end">
                <button onclick="hideOrderCanceledSuccessModal()" class="text-gray-400 hover:text-gray-600">
                    <!-- Close Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <h2 class="text-xl font-bold text-center mb-4 text-gray-800">Your Order Canceled</h2>

            <!-- Custom Heart Icon (to match the image) -->
            <div class="flex justify-center mb-6">
                <!-- Large, bright red heart -->
                <svg xmlns="http://www.w3.org/2000/svg" class="heart-icon w-20 h-20 text-[#ff453a]" viewBox="0 0 24 24"
                    fill="currentColor">
                    <path
                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
                <!-- Smaller, yellow heart (offset for the layered effect) -->
                <svg xmlns="http://www.w3.org/2000/svg"
                    class="heart-icon w-10 h-10 text-[#ffb020] absolute translate-x-[-30px] translate-y-[-10px] z-[71]"
                    viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
            </div>


            <p class="text-center font-medium text-gray-800 mb-2">
                We're sorry to see your order go. 😔
            </p>
            <p class="text-center text-sm text-gray-500 mb-6">
                We're always striving to improve, and we hope to serve you better next time!
            </p>

            <button onclick="hideOrderCanceledSuccessModal()"
                class="w-full bg-[#ff5555] text-white py-3 rounded-lg font-semibold hover:bg-[#e04545] transition shadow-md active:scale-[0.99]">
                Ok
            </button>
        </div>
    </div>


    <script>
        // --- MOCK DATA ---
        const verifyCode = "1234";
        const mockOrderDetails = [
            { name: "Crispy Chicken Sandwich", quantity: 1, price: 12.99 },
            { name: "Large Fries", quantity: 1, price: 3.50 },
            { name: "Diet Cola (Canned)", quantity: 2, price: 1.50 },
        ];
        const DELIVERY_FEE = 4.00;

        // --- COMMON MODAL LOGIC (for center-pop-up modals) ---
        function toggleModal(modalId, contentId, show) {
            const modal = document.getElementById(modalId);
            const content = document.getElementById(contentId);

            if (show) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                    document.body.classList.add('modal-open');
                }, 10);
            } else {
                content.classList.remove('scale-100', 'opacity-100');
                content.classList.add('scale-95', 'opacity-0');
                document.body.classList.remove('modal-open');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }

        // --- COMMON SLIDE MODAL LOGIC (for full-screen slide modals) ---
        function toggleSlideModal(modalId, show) {
            const modal = document.getElementById(modalId);
            if (show) {
                modal.classList.remove('hidden');
                document.body.classList.add('modal-open');
                setTimeout(() => {
                    modal.classList.add('active');
                }, 10);
            } else {
                modal.classList.remove('active');
                document.body.classList.remove('modal-open');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300); // Must match CSS transition duration
            }
        }

        // --- VERIFY CODE MODAL FUNCTIONS (Center Pop) ---
        function showCodeModal() {
            document.getElementById('code-1').textContent = verifyCode[0];
            document.getElementById('code-2').textContent = verifyCode[1];
            document.getElementById('code-3').textContent = verifyCode[2];
            document.getElementById('code-4').textContent = verifyCode[3];
            toggleModal('verifyCodeModal', 'verifyModalContent', true);
        }

        function hideCodeModal() {
            toggleModal('verifyCodeModal', 'verifyModalContent', false);
        }

        // --- ORDER DETAILS MODAL FUNCTIONS (Center Pop) ---
        function showDetailsModal() {
            let subtotal = 0;
            const itemsList = document.getElementById('orderItemsList');
            itemsList.innerHTML = '';
            mockOrderDetails.forEach(item => {
                const itemTotal = item.quantity * item.price;
                subtotal += itemTotal;
                const listItem = document.createElement('li');
                listItem.className = 'flex justify-between items-center';
                listItem.innerHTML = `
                    <div class="text-gray-700">
                        <span class="font-medium">${item.quantity}x</span> ${item.name}
                    </div>
                    <span class="font-semibold text-gray-800">$${itemTotal.toFixed(2)}</span>
                `;
                itemsList.appendChild(listItem);
            });
            const total = subtotal + DELIVERY_FEE;
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('deliveryFee').textContent = `$${DELIVERY_FEE.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
            toggleModal('orderDetailsModal', 'detailsModalContent', true);
        }

        function hideDetailsModal() {
            toggleModal('orderDetailsModal', 'detailsModalContent', false);
        }

        // --- DRIVER INFO MODAL FUNCTIONS (Screen slide right) ---
        function showDriverInfoModal() {
            toggleSlideModal('driverInfoModal', true);
        }

        function hideDriverInfoModal() {
            toggleSlideModal('driverInfoModal', false);
        }

        // --- CHAT MODAL FUNCTIONS (Screen slide right) ---
        function showChatModal() {
            toggleSlideModal('chatModal', true);
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function hideChatModal() {
            toggleSlideModal('chatModal', false);
            hideAttachmentMenu();
        }

        // --- CANCEL ORDER CONFIRMATION MODAL FUNCTIONS (Screen slide up) ---
        function showCancelModal() {
            // Note: This modal is now the reason selection/final confirmation screen
            toggleSlideModal('cancelOrderModal', true);
        }

        function hideCancelModal() {
            toggleSlideModal('cancelOrderModal', false);
        }

        // --- NEW: CANCELLATION SUCCESS MODAL FUNCTIONS (Center Pop) ---
        function showOrderCanceledSuccessModal() {
            toggleModal('orderCanceledSuccessModal', 'successModalContent', true);
            // Optionally, fire a toast to confirm the state change
            showToast('Order status updated to CANCELED.');
        }

        function hideOrderCanceledSuccessModal() {
            toggleModal('orderCanceledSuccessModal', 'successModalContent', false);
        }

        // --- CANCELLATION CHAIN HANDLER ---
        function handleFinalCancellation() {
            // 1. Hide the reason selection/final confirmation screen
            hideCancelModal();

            // 2. Show the success popup after a brief delay for transition
            setTimeout(showOrderCanceledSuccessModal, 300);

            // NOTE: In a real app, this is where you would call the API to update the order status.
        }

        // --- ATTACHMENT MENU FUNCTIONS (Slide up from bottom) ---
        function toggleAttachmentMenu() {
            const backdrop = document.getElementById('attachmentBackdrop');
            const menu = document.getElementById('attachmentMenu');

            if (menu.classList.contains('active')) {
                // Hide menu
                hideAttachmentMenu();
            } else {
                // Show menu
                backdrop.classList.remove('hidden');
                setTimeout(() => {
                    menu.classList.add('active');
                }, 10);
            }
        }

        function hideAttachmentMenu() {
            const backdrop = document.getElementById('attachmentBackdrop');
            const menu = document.getElementById('attachmentMenu');

            menu.classList.remove('active');
            setTimeout(() => {
                backdrop.classList.add('hidden');
            }, 300);
        }


        // --- Utility to copy ID ---
        function copyDriverId(id) {
            const tempInput = document.createElement('input');
            tempInput.value = id;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            showToast(`ID ${id} copied to clipboard!`);
        }

        // --- Toast/Snackbar for Feedback ---
        function showToast(message) {
            const container = document.getElementById('feedbackToastContainer');
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.className = 'bg-gray-800 text-white px-4 py-2 rounded-full text-sm shadow-lg transition-opacity duration-300';

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2000); // Display for 2 seconds
        }


        // --- EVENT LISTENERS ---
        window.onload = function () {
            // Setup for modals (to hide on backdrop click)
            document.getElementById('verifyCodeModal').addEventListener('click', function (event) {
                if (event.target === this) {
                    hideCodeModal();
                }
            });

            document.getElementById('orderDetailsModal').addEventListener('click', function (event) {
                if (event.target === this) {
                    hideDetailsModal();
                }
            });

            // Setup for Cancellation Success Modal (to hide on backdrop click)
            document.getElementById('orderCanceledSuccessModal').addEventListener('click', function (event) {
                if (event.target === this) {
                    hideOrderCanceledSuccessModal();
                }
            });
        };
    </script>
    <script>
        // Basic modal show/hide helpers tuned for your tailwind classes
        const chatModal = document.getElementById('chatModal');
        const driverInfoModal = document.getElementById('driverInfoModal');
        const attachmentBackdrop = document.getElementById('attachmentBackdrop');
        const attachmentMenu = document.getElementById('attachmentMenu');
        const chatWindow = document.getElementById('chatWindow');

        function _showPanel(el) {
            if (!el) return;
            el.classList.remove('hidden');
            // remove translate-x-full so transition brings it in
            el.classList.remove('translate-x-full');
            el.classList.add('translate-x-0');
        }
        function _hidePanel(el) {
            if (!el) return;
            el.classList.remove('translate-x-0');
            el.classList.add('translate-x-full');
            // hide after transition (300ms)
            setTimeout(() => el.classList.add('hidden'), 320);
        }

        // Chat modal
        function showChatModal() {
            _showPanel(chatModal);
            // scroll chat to bottom after it's visible
            setTimeout(() => {
                if (chatWindow) chatWindow.scrollTop = chatWindow.scrollHeight;
            }, 350);
        }
        function hideChatModal() {
            _hidePanel(chatModal);
        }

        // Driver info modal
        function showDriverInfoModal() {
            _showPanel(driverInfoModal);
        }
        function hideDriverInfoModal() {
            _hidePanel(driverInfoModal);
        }

        // Attachment menu (bottom sheet)
        function toggleAttachmentMenu() {
            if (!attachmentBackdrop) return;
            const isHidden = attachmentBackdrop.classList.contains('hidden');
            if (isHidden) {
                attachmentBackdrop.classList.remove('hidden');
                // allow CSS transition if you have one
                setTimeout(() => {
                    attachmentBackdrop.classList.remove('opacity-0');
                }, 10);
            } else {
                hideAttachmentMenu();
            }
        }
        function hideAttachmentMenu() {
            if (!attachmentBackdrop) return;
            attachmentBackdrop.classList.add('opacity-0');
            setTimeout(() => attachmentBackdrop.classList.add('hidden'), 220);
        }

        // Copy driver id helper
        function copyDriverId(id) {
            if (!navigator.clipboard) {
                // fallback
                const ta = document.createElement('textarea');
                ta.value = id;
                document.body.appendChild(ta);
                ta.select();
                try { document.execCommand('copy'); } catch (e) { }
                document.body.removeChild(ta);
            } else {
                navigator.clipboard.writeText(id).catch(() => { });
            }
            showToast('Driver ID copied');
        }

        // Minimal toast (non-blocking)
        function showToast(msg) {
            const t = document.createElement('div');
            t.textContent = msg;
            Object.assign(t.style, {
                position: 'fixed',
                bottom: '90px',
                left: '50%',
                transform: 'translateX(-50%)',
                background: '#111827',
                color: 'white',
                padding: '8px 14px',
                borderRadius: '8px',
                zIndex: 9999,
                opacity: '0.95',
                fontSize: '13px'
            });
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 1600);
        }

        // Defensive: expose to window if onclick attributes expect globals
        window.showChatModal = showChatModal;
        window.hideChatModal = hideChatModal;
        window.showDriverInfoModal = showDriverInfoModal;
        window.hideDriverInfoModal = hideDriverInfoModal;
        window.toggleAttachmentMenu = toggleAttachmentMenu;
        window.hideAttachmentMenu = hideAttachmentMenu;
        window.copyDriverId = copyDriverId;
        window.showToast = showToast;

        // Quick debug: log if elements not found
        if (!chatModal) console.warn('chatModal element not found');
        if (!driverInfoModal) console.warn('driverInfoModal element not found');
        if (!chatWindow) console.warn('chatWindow element not found');
    </script>
</body>

</html>